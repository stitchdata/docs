---
tap: "stripe"
version: "1.0"

name: "subscriptions"
doc-link: "https://stripe.com/docs/api/subscriptions"
singer-schema: "https://github.com/singer-io/tap-stripe/blob/master/tap_stripe/schemas/subscriptions.json"
description: |
  The `{{ table.name }}` table contains info about subscriptions, which allow you to charge a customer on a recurring basis. A subscription ties a customer to a particular [plan](#plans).

replication-method: "Key-based Incremental"

api-method:
    name: "List subscriptions"
    doc-link: "https://stripe.com/docs/api/subscriptions/list"
    
attributes:
  - name: "id"
    type: "string"
    primary-key: true
    description: "The subscription ID."
    foreign-key-id: "subscription-id"

  - name: "created"
    type: "date-time"
    replication-key: true
    description: "The time the subscription was created. Measured in second since the Unix epoch."

  - name: "application_fee_percent"
    type: "number"
    description: "The percentage of the subscription invoice subtotal that will be transferred to the application owner's {{ integration.display_name }} account. This value will be a decimal between `0` and `100`, with up to two decimal places."

  - name: "billing"
    type: "string"
    description: |
      The type of billing action performed by {{ integration.display_name }} to pay the invoice. Possible values are:

      - `charge_automatically` - {{ integration.display_name }} will attempt to pay the invoice using the default source attached to the customer.
      - `send_invoice` - {{ integration.display_name }} will email this invoice to the customer with payment instructions.

  - name: "billing_cycle_anchor"
    type: "date-time"
    description: "Indicates the date of the first full invoice. With plans with `month` or `year` intervals, the day of the month for subsequent invoices."

  - name: "cancel_at_period_end"
    type: "boolean"
    description: |
      If the subscription has been canceled with `at_period_end: true`, this value will be true.

  - name: "canceled_at"
    type: "date-time"
    description: "The date the subscription was canceled."

  - name: "current_period_end"
    type: "date-time"
    description: "The end of the current period that the subscription has been invoiced for."

  - name: "current_period_start"
    type: "date-time"
    description: "The start of the current period that the subscription has been invoiced for."

  - name: "customer"
    type: "string"
    description: "THe ID of the customer who owns the subscription."
    foreign-key-id: "customer-id"

  - name: "days_until_due"
    type: "integer"
    description: "The number of days a customer has to pay invoices generated by the subscription."

  - name: "discount"
    type: "object"
    description: "Describes the current discount active on the subscription."
    subattributes:
      - name: "coupon"
        type: "object"
        description: "Details about the coupon applied to the subscription."
        subattributes:
          - name: "id"
            type: "string"
            description: "The coupon ID."
            foreign-key-id: "coupon-id"

          - name: "amount_off"
            type: "integer"
            description: "The amount (in the `currency` specified) that will be taken off the subtotal of any invoices for this customer."

          - name: "created"
            type: "date-time"
            description: "The time at which the coupon was created. Measured in seconds since the Unix epoch."

          - name: "currency"
            type: "string"
            description: |
              The three-letter [ISO currency code](https://www.iso.org/iso-4217-currency-codes.html){:target="new"} of the amount to take off (`amount_off`).

          - name: "duration"
            type: "string"
            description: |
              Indicates how long a customer who applies this coupon will get the discount. Possible values are:

              - `forever`
              - `once`
              - `repeating`

          - name: "duration_in_months"
            type: "integer"
            description: "Indicates the number of months the coupon applies if `duration: repeating`."

          - name: "livemode"
            type: "boolean"
            description: "Indicates if the coupon exists in live mode (`true`) or in test mode (`false`)."

          - name: "max_redemptions"
            type: "integer"
            description: "The maximum number of times this coupon can be redeemed in total across all customers before it is no longer valid."

          - name: "metadata"
            type: "object"
            description: ""
            anchor-id: 1
            subattributes: &metadata
              - name: "ANYTHING"
                type: "ANYTHING"
                description: "This info will vary."

          - name: "name"
            type: "string"
            description: "The name of the coupon as it is displayed to customers."

          - name: "object"
            type: "string"
            description: "The type of {{ integration.display_name }} object. This will be `coupon`."

          - name: "percent_off"
            type: "integer"
            description: "The percent that will be taken off the subtotal of any invoices for this customer for the duration of the coupon."

          - name: "percent_off_precise"
            type: "number"
            description: ""

          - name: "redeem_by"
            type: "date-time"
            description: "The date afer which the coupon can no longer be redeemed."

          - name: "times_redeemed"
            type: "integer"
            description: "The number of times this coupon has been applied to a customer."

          - name: "valid"
            type: "boolean"
            description: "Taking into account all of the other coupon properties, indicates whether this coupon can still be applied to a customer."

  - name: "ended_at"
    type: "date-time"
    description: "If the subscription has ended, the date the subscription ended."

  - name: "items"
    type: "array"
    description: "The subscription items associated with the subscription."
    subattributes:
      - name: "value"
        type: "string"
        primary-key: true
        description: "The subscription item ID."
        foreign-key-id: "subscription-item-id"

  - name: "livemode"
    type: "boolean"
    description: "Indicates if the object exists in live mode (`true`) or in test mode (`false`)."

  - name: "metadata"
    type: "object"
    description: ""
    anchor-id: 2
    subattributes: *metadata

  - name: "object"
    type: "string"
    description: "The type of {{ integration.display_name }} object. This will be `subscription`."

  - name: "plan"
    type: "object"
    description: "Details about the plan the customer subscribed to."
    subattributes:
      - name: "active"
        type: "boolean"
        description: "Indicates if the plan is currently available for new subscriptions."

      - name: "aggregate_usage"
        type: "string"
        description: |
          Indicates a usage aggregation strategy for plans of `usage_type: metered`. Possible values are:

          - `sum` - Sums up all usage during a period
          - `last_during_period` - Selects the last usage record reported within a period
          - `last_ever` - Selects the last usage record ever (across period bounds)
          - `max` - Selects the usage record with the maximum reported usage during a period

      - name: "amount"
        type: "integer"
        description: "The amount (in cents) to be charged on the interval specified."

      - name: "billing_scheme"
        type: "string"
        description: |
          Indicates how the price per period should be computed. Possible values are:

          - `per_unit` - Indicates that the fixed `amount` will be charged per unit (`quantity`) for plans with `usage_type: licensed`, or per unit of total usage for plans with `usage_type: metered`.
          - `tiered` - Indicates that unit pricing will be computed using a tiering strategy as defined using `tiers` and `tiers_mode`.

      - name: "created"
        type: "date-time"
        description: "Time at which the object was created. Measured in seconds since the Unix epoch."

      - name: "currency"
        type: "string"
        description: The three-letter [ISO currency code](https://www.iso.org/iso-4217-currency-codes.html){:target="new"}, in lowercase.

      - name: "id"
        type: "string"
        description: "The plan ID."
        foreign-key-id: "plan-id"

      - name: "interval"
        type: "string"
        description: |
          The frequency with which a subscription should be billed. Possible values are `day`, `week`, `month`, or `year`.

      - name: "interval_count"
        type: "integer"
        description: |
          The number of intervals (specified by `interval`) between subscription billings.

          For example: `interval: month` and `interval_count: 3` would bill every three months.

      - name: "livemode"
        type: "boolean"
        description: "Indicates if the object exists in live mode (`true`) or in test mode (`false`)."

      - name: "metadata"
        type: "object"
        description: "Additional information attached to the plan."
        anchor-id: 3
        subattributes: *metadata

      - name: "nickname"
        type: "string"
        description: "A brief description of the plan, not visible to customers."

      - name: "object"
        type: "string"
        description: "The type of {{ integration.display_name }} object. This will be `plan`."

      - name: "product"
        type: "string"
        description: "The product whose pricing this plan determines."
        foreign-key-id: "product-id"

      - name: "tiers"
        type: "array"
        description: "The pricing tiers associated with the plan."
        subattributes:
          - name: "value"
            type: "integer"
            description: "The pricing tier."

      - name: "tiers_mode"
        type: "string"
        description: |
          Indicates if the pricing tier should be `graduated` or `volume`- based.

          - `volume` - The maximum quantity within a period determines the per unit price
          - `graduated` - Pricing can successively change as the quantity grows

      - name: "transform_usage"
        type: "string"
        description: "Applies a transformation to the reported usage or set quantity before computing the billed price."

      - name: "trial_period_days"
        type: "integer"
        description: "The default number of trial days when subscribing a customer to this plan."

      - name: "usage_type"
        type: "string"
        description: |
          Indicates how the quantity per period should be determined. Possible values are:

          - `metered` - Aggregates total usage based on usage records.
          - `licensed` - Automtaically bills the `quantity` set for a plan when it's added to a subscription.

  - name: "quantity"
    type: "integer"
    description: |
      The quantity of the plan to w hich the customer is subscribed.

      For example: If a plan is $20/user/month, and a customer has 5 users, the this value would be `5`. This would result in the customer being charged $100.

  - name: "start"
    type: "date-time"
    description: "The date the subscription was last updated."

  - name: "status"
    type: "string"
    description: |
      The status of the subscription. Possible values are:

      - `trialing` - Indicates that the subscription is still in its trial period.
      - `active` - Indicates the subscription's trial period is over.
      - `past_due` - Indicates the subscription is past due.
      - `canceled` - Indicates the subscription was canceled.
      - `unpaid` - Indicates the subscription is unpaid.

  - name: "tax_percent"
    type: "number"
    description: "The tax rate applied to the subscription."

  - name: "trial_end"
    type: "date-time"
    description: "If the subscription has a trial, the end of the trial."

  - name: "trial_start"
    type: "date-time"
    description: "If the subscription has a trial, the start of the trial."

  - name: "updated"
    type: "date-time"
    description: "The time the subscription was last updated."
---