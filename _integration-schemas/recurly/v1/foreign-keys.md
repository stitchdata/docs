---
tap-reference: "recurly"

version: "1"

foreign-keys:
  - id: "account-id"
    attribute: "account_id"
    table: "accounts"
    all-foreign-keys:
      - table: "accounts"
        join-on: "id"
      - table: "accounts"
        join-on: "parent_account_id"
      - table: "accounts"
        subtable: "shipping_addresses"
      - table: "adjustments"
        subattribute: "account"
        join-on: "id"
      - table: "adjustments"
        subattribute: "account"
        join-on: "parent_account_id"
      - table: "billing_info"
      - table: "coupon_redemptions"
      - table: "invoices"
        subattribute: "account"
        join-on: "id"
      - table: "invoices"
        subattribute: "account"
        join-on: "parent_account_id"
      - table: "invoices"
        subtable: "credit_payments.refund_transaction.account"
        join-on: "id"
      - table: "invoices"
        subtable: "line_items.shipping_addresses"
      - table: "subscriptions"
        subtable: "shipping_addresses"
      - table: "transactions"
        subtable: "account"
        join-on: "id"
      - table: "transactions"
        subtable: "account"
        join-on: "parent_account_id"

  - id: "adjustment-id"
    attribute: "adjustment_id"
    table: "adjustments"
    all-foreign-keys:
      - table: "adjustments"
        join-on: "id"

  - id: "coupon-id"
    attribute: "coupon_id"
    table: "coupons"
    all-foreign-keys:
      - table: "coupon_redemptions"
        subattribute: "coupon"
        join-on: "id"
      - table: "coupons"
        join-on: "id"
      - table: "subscriptions"
        subtable: "coupon_redemptions__coupon"
        join-id: "id"

  - id: "coupon-redemption-id"
    attribute: ""
    table: "coupon_redemptions"
    all-foreign-keys:
      - table: "coupon_redemptions"
        join-on: "id"
      - table: "subscriptions"
        subtable: "coupon_redemptions"
        join-id: "id"

  - id: "invoice-id"
    attribute: "invoice_id"
    table: "invoices"
    all-foreign-keys:
      - table: "adjustments"
      - table: "invoices"
        join-on: "id"
      - table: "invoices"
        subtable: "credit_payments.applied_to_invoice"
        join-on: "id"
      - table: "invoices"
        subtable: "credit_payments.original_invoice"
        join-on: "id"
      - table: "invoices"
        subtable: "credit_payments.refund_transaction.invoice"
        join-on: "id"
      - table: "invoices"
        subtable: "credit_payments.refund_transaction.voided_by_invoice"
        join-on: "id"
      - table: "invoices"
        subtable: "line_items"
      - table: "invoices"
        subtable: "subscription_ids"
        join-on: "value"
      - table: "transactions"
        subattribute: "invoice"
        join-on: "id"
      - table: "transactions"
        subattribute: "voided_by_invoice"
        join-on: "id"

  - id: "plan-id"
    attribute: "plan_id"
    table: "plans"
    all-foreign-keys:
      - table: "adjustments"
      - table: "invoices"
        subtable: "line_items"
      - table: "plans"
        join-on: "id"
      - table: "plan_add_ons"
      - table: "subscriptions"
        subtable: "pending_change__plan"
        join-on: "id"

  - id: "plan-add-on-id"
    attribute: "add_on_id"
    table: "plan_add_ons"
    all-foreign-keys:
      - table: "adjustments"
      - table: "invoices"
        subtable: "line_items"
      - table: "plan_add_ons"
        join-on: "id"
      - table: "subscriptions"
        subtable: "add_ons__ad_on"
        join-on: "id"

  - id: "subscription-id"
    attribute: "subscription_id"
    table: "subscriptions"
    all-foreign-keys:
      - table: "invoices"
        subtable: "credit_payments.refund_transaction.subscription_ids"
      - table: "invoices"
        subtable: "line_items"
      - table: "subscriptions"
        join-on: "id"
      - table: "subscriptions"
        subtable: "add_ons"
      - table: "subscriptions"
        subtable: "pending_change__add_ons"
      - table: "subscriptions"
        subtable: "pending_change"
      - table: "transactions"
        subtable: "subscription_ids"
        join-on: "value"

  - id: "transaction-id"
    attribute: ""
    table: "transactions"
    all-foreign-keys:
      - table: "invoices"
        subtable: "credit_payments.refund_transaction"
        join-on: "id"
      - table: "invoices"
        subtable: "credit_payments.refund_transaction"
        join-on: "original_transaction_id"
      - table: "invoices"
        subtable: "transactions"
        join-on: "id"
      - table: "transactions"
        join-on: "id"
      - table: "transactions"
        join-on: "original_transaction_id"
---