---
tap-reference: "chargebee"

version: "1.0"

foreign-keys:
  - id: "addon-id"
    attribute: ""
    table: "addons"
    all-foreign-keys:
      - table: "addon"
        join-on: "id"
      - table: "events"
        subattribute: "content.subscription.addons"
        join-on: "id"
      - table: "events"
        subattribute: "content.subscription.charged_event_based_addons"
        join-on: "id"
      - table: "events"
        subattribute: "content.subscription.event_based_addons"
        join-on: "id"
      - table: "invoices"
        subattribute: "notes"
        join-on: "entity_id"
      - table: "subscriptions"
        subattribute: "addons"
        join-on: "id"
      - table: "subscriptions"
        subattribute: "charged_event_based_addons"
        join-on: "id"
      - table: "subscriptions"
        subattribute: "event_based_addons"
        join-on: "id"

  - id: "coupon-id"
    attribute: "coupon_id"
    table: "coupons"
    all-foreign-keys:
      - table: "coupons"
        join-on: "id"
      - table: "credit_notes"
        subattribute: "discounts"
        join-on: "entity_id"
      - table: "credit_notes"
        subattribute: "line_item_discounts"
      - table: "events"
        subattribute: "content.coupon"
        join-on: "id"
      - table: "events"
        subattribute: "content.invoice.discounts"
        join-on: "entity_id"
      - table: "events"
        subattribute: "content.invoice.line_item_discounts"
      - table: "events"
        subattribute: "content.subscription.coupons"
      - table: "invoices"
        subattribute: "discounts"
        join-on: "entity_id"
      - table: "invoices"
        subattribute: "line_item_discounts"
      - table: "invoices"
        subattribute: "notes"
        join-on: "entity_id"
      - table: "subscriptions"
        subattribute: "coupons"

  - id: "credit-note-id"
    attribute: "cn_id"
    table: "credit_notes"
    all-foreign-keys:
      - table: "credit_notes"
        join-on: "id"
      - table: "events"
        subattribute: "content.invoice.adjustment_credit_notes"
      - table: "events"
        subattribute: "content.invoice.applied_credits"
      - table: "events"
        subattribute: "content.invoice.issued_credit_notes"
      - table: "invoices"
        subattribute: "adjustment_credit_notes"
      - table: "invoices"
        subattribute: "adjustment_applied_credits"
      - table: "invoices"
        subattribute: "linked_credit_notes"

  - id: "customer-id"
    attribute: "customer_id"
    table: "customers"
    all-foreign-keys:
      - table: "credit_notes"
      - table: "customers"
        join-on: "id"
      - table: "events"
        subattribute: "content.customer"
        join-on: "id"
      - table: "events"
        subattribute: "content.invoice"
      - table: "events"
        subattribute: "content.subscription"
      - table: "events"
        subattribute: "content.transaction"
      - table: "invoices"
      - table: "invoices"
        subattribute: "notes"
        join-on: "entity_id"
      - table: "payment_sources"
      - table: "subscriptions"
      - table: "transactions"
      - table: "virtual_bank_accounts"

  - id: "line-item-id"
    attribute: "line_item_id"
    table: ""
    all-foreign-keys:
      - table: "credit_notes"
        subattribute: "line_item_discounts"
      - table: "credit_notes"
        subattribute: "line_item_taxes"
      - table: "credit_notes"
        subattribute: "line_item_tiers"
      - table: "credit_notes"
        subattribute: "line_items"
        # join-on: "id"
      - table: "events"
        subattribute: "content.invoice.line_item_discounts"
      - table: "events"
        subattribute: "content.invoice.line_item_taxes"
      - table: "events"
        subattribute: "content.invoice.line_items"
        join-on: "id"
      - table: "invoices"
        subattribute: "line_item_discounts"
      - table: "invoices"
        subattribute: "line_item_taxes"
      - table: "invoices"
        subattribute: "line_item_tiers"
      - table: "invoices"
        subattribute: "line_items"

  - id: "invoice-id"
    attribute: "invoice_id"
    table: "invoices"
    all-foreign-keys:
      - table: "credit_notes"
        subattribute: "allocations"
      - table: "credit_notes"
        join-on: "reference_invoice_id"
      - table: "events"
        subattribute: "content.invoice"
        join-on: "id"
      - table: "events"
        subattribute: "content.transaction.linked_credit_notes"
        join-on: "cn_reference_invoice_id"
      - table: "events"
        subattribute: "content.transaction.linked_payments"
      - table: "invoices"
        join-on: "id"
      - table: "transactions"
        subattribute: "linked_credit_notes"
        join-on: "cn_reference_invoice_id"
      - table: "transactions"
        subattribute: "linked_payments"

  - id: "plan-id"
    attribute: "plan_id"
    table: "plans"
    all-foreign-keys:
      - table: "events"
        subattribute: "content.plan"
        join-on: "id"
      - table: "events"
        subattribute: "content.subscription"
      - table: "plans"
        join-on: "id"
      - table: "invoices"
        subattribute: "notes"
        join-on: "entity_id"
      - table: "subscriptions"

  - id: "payment-source-id"
    attribute: "payment_source_id"
    table: "payment_sources"
    all-foreign-keys:
      - table: "customers"
        join-on: "primary_payment_sources_id"
      - table: "events"
        subattribute: "content.subscription"
      - table: "events"
        subattribute: "content.transaction"
      - table: "payment_sources"
        join-on: "id"
      - table: "subscriptions"
      - table: "transactions"

  - id: "subscription-id"
    attribute: "subscription_id"
    table: "subscriptions"
    all-foreign-keys:
      - table: "credit_notes"
      - table: "credit_notes"
        subattribute: "line_items"
      - table: "events"
        subattribute: "content.invoice.linked_payments"
      - table: "events"
        subattribute: "content.subscription"
        join-on: "id"
      - table: "events"
        subattribute: "content.invoice"
      - table: "events"
        subattribute: "content.transaction"
      - table: "invoices"
        subattribute: "line_items"
      - table: "invoices"
        subattribute: "notes"
        join-on: "entity_id"
      - table: "invoices"
      - table: "subscriptions"
        join-on: "id"
      - table: "transactions"

  - id: "transaction-id"
    attribute: "txn_id"
    table: "transactions"
    all-foreign-keys:
      - table: "credit_notes"
        subattribute: "linked_refunds"
      - table: "events"
        subattribute: "content.invoice.linked_payments"
      - table: "events"
        subattribute: "content.transaction"
        join-on: "id"
      - table: "events"
        subattribute: "content.transaction"
        join-on: "id"
      - table: "events"
        subattribute: "content.transaction.linked_refunds"
      - table: "events"
        subattribute: "content.transaction"
        join-on: "reference_transaction_id"
      - table: "events"
        subattribute: "content.transaction"
        join-on: "refunded_txn_id"
      - table: "invoices"
        subattribute: "linked_payments"
      - table: "transactions"
        join-on: "id"
      - table: "transactions"
        subattribute: "linked_refunds"
      - table: "transactions"
        join-on: "reference_transaction_id"
      - table: "transactions"
        join-on: "refunded_txn_id"
---