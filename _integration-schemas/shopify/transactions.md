---
tap: "shopify"
version: "1.0"

name: "transactions"
doc-link: "https://help.shopify.com/en/api/reference/orders/transaction"
singer-schema: "https://github.com/singer-io/tap-shopify/blob/master/tap_shopify/schemas/transactions.json"
description: |
  The `{{ table.name }}` table contains info about transactions.

replication-method: "Key-based Incremental"

api-method:
    name: "Retrieve a list of transactions"
    doc-link: "https://help.shopify.com/en/api/reference/orders/transaction#index"

date-time: |
  The date and time in [ISO 8601 format](https://en.wikipedia.org/wiki/ISO_8601){:target="new"} when the [ITEM] was [ACTION].

attributes:
  - name: "id"
    type: "integer"
    primary-key: true
    description: "The transaction ID."
    foreign-key-id: "transaction-id"

  - name: "created_at"
    type: "string"
    replication-key: true
    description: |
      {{ table.date-time | replace: "[ITEM]","transaction" | replace: "[ACTION]","created" }}

  # - name: "admin_graphql_api_id"
  #   type: "string"
  #   description: ""

  - name: "amount"
    type: "number"
    description: "The amount of money that the transaction was for."

  - name: "authorization"
    type: "string"
    description: "The authorization code associated with the transaction."

  - name: "currency"
    type: "string"
    description: |
      The three-letter [ISO 4217](https://en.wikipedia.org/wiki/ISO_4217){:target="new"} code for the currency used for payment. For example: `USD`

  - name: "device_id"
    type: "integer"
    description: "The ID for the device."

  - name: "error_code"
    type: "string"
    description: |
      A standardized error code, independent of the payment provider. Possible values are:

      - `incorrect_number`
      - `invalid_number`
      - `invalid_expiry_date`
      - `invalid_cvc`
      - `expired_card`
      - `incorrect_cvc`
      - `incorrect_zip`
      - `incorrect_address`
      - `card_declined`
      - `processing_error`
      - `call_issuer`
      - `pick_up_card`

  - name: "gateway"
    type: "string"
    description: |
      The name of the gateway the transaction was issued through. For a list of possible values, refer to [Shopify's payment gateways documentation](https://www.shopify.com/payment-gateways){:target="new"}.

  - name: "kind"
    type: "string"
    description: |
      The transaction type. Possible values are:

      - `authorization` - Money that the customer has agreed to pay. The authorization period can be between seven and 30 days while a store waits for a payment to be captured.
      - `capture` - A transfer of money that was reserved during the authorization of a shop.
      - `sale` - The authorization and capture of a payment.
      - `void` - The cancellation of a pending authorization or capture.
      - `refund` - The parial or full return of captured money to the customer.

  - name: "location_id"
    type: "integer"
    description: "The ID of the location that processed the transaction."

  - name: "message"
    type: "string"
    description: "A message generated by the payment provider with additional info about why the transaction succeeded or failed."

  - name: "order_id"
    type: "integer"
    description: "The ID of the order the transaction is associated with."
    foreign-key-id: "order-id"

  - name: "parent_id"
    type: "integer"
    description: |
      The ID of an associated transaction.

      - For `capture` transactions, the parent needs to be an `authorization` transaction.
      - For `void` transactions, the parent needs to be an `authorization` transaction.
      - For `refund` transactions, the parent needs to be a `capture` or `sale` transaction.
    foreign-key-id: "transaction-id"

  - name: "payment_details"
    type: "object"
    description: "Details about the credit card used for the transaction."
    object-properties:
      - name: "avs_result_code"
        type: "string"
        description: |
          The response code from the [address verification system](https://en.wikipedia.org/wiki/Address_Verification_System){:target="new"}. Refer to [Electronic Merchant System's documentation](http://www.emsecommerce.net/avs_cvv2_response_codes.htm){:target="new"} for a list of possible codes and definitions.

      - name: "credit_card_bin"
        type: "string"
        description: |
          The [issuer identification number](https://en.wikipedia.org/wiki/ISO/IEC_7812){:target="new"} (IIN), formerly known as bank identification number (BIN) of the customer's credit card. This is made up of the first few digits of the credit card number.

      - name: "credit_card_company"
        type: "string"
        description: "The name of the company that issued the customer's credit card."

      - name: "credit_card_number"
        type: "string"
        description: "The customer's credit card number, **with most of the leading digits redacted**."

      - name: "cvv_result_code"
        type: "string"
        description: |
          The response code from the credit card company indicating whether the customer entered the card security code or card verification value (CVV) correctly. Refer to [Electronic Merchant System's documentation](http://www.emsecommerce.net/avs_cvv2_response_codes.htm){:target="new"} for a list of possible codes and defintions.

  - name: "receipt"
    type: "object"
    description: "A transaction receipt attached to the transaction by the gateway."
    subattributes:
      - name: "authorization"
        type: "integer"
        description: "The authorization number associated with the receipt."

  - name: "source_name"
    type: "string"
    description: |
      The origin of the transaction, set by {{ integration.display_name }}. Possible values are:

      - `web`
      - `pos`
      - `iphone`
      - `android`

  - name: "status"
    type: "string"
    description: |
      The status of the transaction. Possible values are:

      - `pending`
      - `failure`
      - `success`
      - `error`

  - name: "test"
    type: "boolean"
    description: "Indicates if the transaction was a test transaction."

  - name: "user_id"
    type: "integer"
    description: "The ID of the user who was logged into the {{ integration.display_name }} POS device when the order was processed, if applicable."
---